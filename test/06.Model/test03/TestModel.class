<?php
/* Copyright 2016 dodat */
/*---------------------------------------------------------------------------*
 * Test
 *      エンティティモデル生成
 *---------------------------------------------------------------------------*/
namespace sample;

class TestModel extends \PR\Model{

	public $oAllDataType = null;
	public $iIdxType = 0;

	public function start($riIdxType=0){
		$this->iIdxType = $riIdxType;

		// DB接続
		$this->oDao->connect();
		$this->oDao->begin();

		// Index
		$this->oAllDataType = new AllDataType($this->oDao);
		if($riIdxType == 0){
			$this->oAllDataType->setIndex(\PR\Model::IDX_SERIAL);
		}else if($riIdxType == 1){
			$this->oAllDataType->setIndex(\PR\Model::IDX_HIERARCHY,array('prCol_Alphabet','prCol_Numeric'));
		}else if($riIdxType == 2){
			$this->oAllDataType->setIndex(\PR\Model::IDX_JOINKEY,array('prCol_Alphabet','prCol_Numeric'));
		}

		// ページャ設定
		$pager = new \PR\Pager('0603.php',100,5);
		$this->oAllDataType->setPager($pager);
	}

	public function end($rbCommit=false){
		if($rbCommit){
			$this->oDao->commit();
		}else{
			$this->oDao->rollback();
		}
	}

	// 一覧の取得
	public function listData(){
		$rc = $this->oAllDataType->pageX();
		return $rc;
	}

	// 1 件参照
	public function select(){
		$this->oAllDataType->post();
		$rc = $this->oAllDataType->readX();
		return $rc;
	}

	// データの追加
	public function insert(){
		$this->oAllDataType->post();
		$this->sErrMsg = $this->oAllDataType->checkPostByTarget('<br>',6,0,2);
		if(!empty($this->sErrMsg)) return C_PR_ERR_EPARAM;
		$rc = $this->oAllDataType->addX();
		if($rc != 0) return $rc;
		return 0;
	}

	// データの更新
	public function update(){
		$this->oAllDataType->post();
		$this->sErrMsg = $this->oAllDataType->checkPostByTarget('<br>',6,0,2);
		if(!empty($this->sErrMsg)) return C_PR_ERR_EPARAM;
		$rc = $this->oAllDataType->updateX();
		if($rc != 0) return $rc;
		return 0;
	}

	// データの削除
	public function remove(){
		$this->oAllDataType->post();
		$this->sErrMsg = $this->oAllDataType->checkPostByTarget('<br>',6,0,2);
		if(!empty($this->sErrMsg)) return C_PR_ERR_EPARAM;
		$rc = $this->oAllDataType->removeX();
		if($rc != 0) return $rc;
		return 0;
	}
}
?>
