<?php
/* Copyright 2013 dodat */
/*---------------------------------------------------------------------------*
 * Class - Data Access Object
 *      DBアクセスオブジェクト生成クラス
 *---------------------------------------------------------------------------*/
namespace PR;

class DaoFactory{

	private static $aDaos__ = array();

	public static function create($rsName=null){
		$sName = $rsName;
		if(empty($sName)) $sName = 'DEFAULT';
		$dao = null;
		if(array_key_exists($sName,self::$aDaos__)){
			$dao = clone self::$aDaos__[$sName];
			return $dao;
		}

		$suffix = '_'.$sName;
		if($sName == 'DEFAULT') $suffix = '';
		if(!defined('C_PR_DAO_TYPE'.$suffix)){
			throw new Exception(C_PR_ERR_ENOENT,SMSG('PR_E008','C_PR_DAO_XXX'));
		}
		$type = constant('C_PR_DAO_TYPE'.$suffix);
		$host = constant('C_PR_DAO_HOST'.$suffix);
		$user = constant('C_PR_DAO_USER'.$suffix);
		$pass = constant('C_PR_DAO_PASSWORD'.$suffix);
		$name = SysEnv::getDaoName();

		if($type == Dao::DB_MYSQL){
			$dao = new DaoMySQL($host,$user,$pass,$name);
		}else if($type == Dao::DB_POSTGRES){
			$dao = new DaoPostgres($host,$user,$pass,$name);
		}
		self::$aDaos__[$sName] = $dao;
		return $dao;
	}
}
?>
